<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Self Growth Web App - Complete</title>
<style>
body{margin:0;font-family:system-ui;background:linear-gradient(180deg,#1e1b4b,#020617);color:#fff}
.card{max-width:480px;margin:auto;padding:16px}
.hidden{display:none}
h1{font-size:1.4rem;margin:8px 0}
button,select,input{width:100%;padding:12px;margin-top:10px;border-radius:14px;border:none;font-size:1rem}
button{background:#6366f1;color:#fff;font-weight:bold}
.sub{background:#334155}
.panel{background:#0f172a;padding:14px;border-radius:20px;margin-top:12px;box-shadow:0 0 20px rgba(99,102,241,.3)}
.code{font-size:1.6rem;text-align:center;letter-spacing:4px;font-weight:bold}
.progress{background:#1e293b;border-radius:12px;overflow:hidden;height:18px;margin-top:6px}
.bar{height:100%;background:linear-gradient(90deg,#6366f1,#22d3ee)}
.small{font-size:.85rem;color:#c7d2fe}
.goal{background:#1e293b;padding:8px;border-radius:10px;margin-top:6px}
canvas{background:#fff;border-radius:12px;margin-top:12px}
</style>
</head>
<body>
<div class="card">

<!-- ENTRY -->

<div id="entry" class="panel">
<h1>Self Growth</h1>
<button onclick="newAccount()">æ–°ã—ãå§‹ã‚ã‚‹</button>
<button class="sub" onclick="showLogin()">å¼•ãç¶™ãã‚³ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³</button>
</div>

<!-- SETUP -->

<div id="setup" class="panel hidden">
<h1>åˆæœŸè¨­å®š</h1>
<input id="nickname" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ">
<button onclick="saveUser()">é–‹å§‹</button>
</div>

<!-- LOGIN -->

<div id="login" class="panel hidden">
<h1>ãƒ­ã‚°ã‚¤ãƒ³</h1>
<input id="loginCode" placeholder="å¼•ãç¶™ãã‚³ãƒ¼ãƒ‰">
<button onclick="loginWithCode()">ãƒ­ã‚°ã‚¤ãƒ³</button>
</div>

<!-- GOALS -->

<div id="goalScreen" class="panel hidden">
<h1>ç›®æ¨™ç®¡ç†</h1>
<input id="goalInput" placeholder="æ–°ã—ã„ç›®æ¨™">
<button onclick="addGoal()">è¿½åŠ </button>
<div id="goalList"></div>
<button onclick="goMain()">ãƒ¡ã‚¤ãƒ³ã¸</button>
</div>

<!-- MAIN -->

<div id="main" class="panel hidden">
<h1 id="welcome"></h1>
<div class="small">å¼•ãç¶™ãã‚³ãƒ¼ãƒ‰</div>
<div class="code" id="myCode"></div>

<div class="panel">
<div class="small">ãƒ¬ãƒ™ãƒ«</div>
<div><strong>Lv.<span id="level">1</span></strong></div>
<div class="progress"><div id="expBar" class="bar" style="width:0%"></div></div>
<div class="small">æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ <span id="nextExp">0</span> EXP</div>
</div>

<div class="panel">
<div class="small">ä»Šé€±ã®æ®‹ã‚Šæ™‚é–“</div>
<div><strong><span id="remainWeek">0</span> åˆ†</strong></div>
</div>

<select id="subject"></select>

<div class="small">è¨ˆæ¸¬æ™‚é–“: <span id="time">0</span> ç§’</div>
<button onclick="start()">START</button>
<button class="sub" onclick="stop()">STOP</button>
<button class="sub" onclick="showLogs()">è¨˜éŒ²</button>
<button class="sub" onclick="showGraph()">ã‚°ãƒ©ãƒ•</button>
</div>

<!-- LOGS -->

<div id="logs" class="panel hidden">
<h1>è¨˜éŒ²</h1>
<div id="streak"></div>
<div id="logList"></div>
<button onclick="backMain()">æˆ»ã‚‹</button>
</div>

<!-- GRAPH -->

<div id="graph" class="panel hidden">
<h1>ã‚°ãƒ©ãƒ•</h1>
<canvas id="chart" width="320" height="220"></canvas>
<button onclick="backMainFromGraph()">æˆ»ã‚‹</button>
</div>
</div>

<script>
let timer=null,sec=0;

function generateCode(){return Math.random().toString(36).substring(2,8).toUpperCase()}
function getAll(){return JSON.parse(localStorage.getItem('accounts'))||{}}
function saveAll(a){localStorage.setItem('accounts',JSON.stringify(a))}
function getCurrent(){return localStorage.getItem('currentCode')}

function newAccount(){entry.classList.add('hidden');setup.classList.remove('hidden')}
function showLogin(){entry.classList.add('hidden');login.classList.remove('hidden')}

function saveUser(){const name=nickname.value.trim();if(!name)return;const all=getAll();let code=generateCode();while(all[code])code=generateCode();all[code]={name,goals:[],logs:{},exp:0,level:1,weeklyGoal:600};saveAll(all);localStorage.setItem('currentCode',code);init()}

function loginWithCode(){const code=loginCode.value.trim().toUpperCase();const all=getAll();if(!all[code])return alert('ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');localStorage.setItem('currentCode',code);init()}

function init(){entry.classList.add('hidden');setup.classList.add('hidden');login.classList.add('hidden');const code=getCurrent();if(!code)return entry.classList.remove('hidden');goalScreen.classList.remove('hidden');renderGoals()}

function getData(){return getAll()[getCurrent()]}
function saveData(d){const all=getAll();all[getCurrent()]=d;saveAll(all)}

function addGoal(){const d=getData();const g=goalInput.value.trim();if(!g)return;d.goals.push({text:g});saveData(d);goalInput.value='';renderGoals()}

function renderGoals(){const d=getData();goalList.innerHTML='';subject.innerHTML='';d.goals.forEach(g=>{const div=document.createElement('div');div.className='goal';div.textContent=g.text;goalList.appendChild(div);const opt=document.createElement('option');opt.textContent=g.text;subject.appendChild(opt)})}

function goMain(){goalScreen.classList.add('hidden');main.classList.remove('hidden');const d=getData();welcome.textContent=`ã‚ˆã†ã“ã ${d.name}`;myCode.textContent=getCurrent();updateStatus()}

function needExp(lv){return Math.floor(100*Math.pow(1.2,lv-1))}

function updateStatus(){const d=getData();level.textContent=d.level;const next=needExp(d.level);const cur=d.exp;expBar.style.width=Math.min(100,(cur/next)*100)+'%';nextExp.textContent=Math.max(0,next-cur);remainWeek.textContent=calcRemainWeek(d)}

function calcRemainWeek(d){let used=0;const now=new Date();const monday=new Date(now);monday.setDate(now.getDate()-now.getDay()+1);Object.entries(d.logs).forEach(([day,subs])=>{const dt=new Date(day);if(dt>=monday)Object.values(subs).forEach(t=>used+=Math.floor(t/60))});return Math.max(0,d.weeklyGoal-used)}

function start(){sec=0;time.textContent=0;timer=setInterval(()=>{sec++;time.textContent=sec},1000)}

function stop(){clearInterval(timer);const d=getData();const day=new Date().toISOString().slice(0,10);const sub=subject.value;if(!d.logs[day])d.logs[day]={};d.logs[day][sub]=(d.logs[day][sub]||0)+sec;const gain=Math.floor((sec/60)*Math.log2(2));d.exp+=gain;while(d.exp>=needExp(d.level)){d.exp-=needExp(d.level);d.level++}saveData(d);updateStatus();alert('ä¿å­˜ã—ã¾ã—ãŸ')}

function showLogs(){main.classList.add('hidden');logs.classList.remove('hidden');renderLogs()}
function backMain(){logs.classList.add('hidden');main.classList.remove('hidden')}

function renderLogs(){const d=getData();logList.innerHTML='';let streakCount=0;let prev=null;Object.keys(d.logs).sort().reverse().forEach(day=>{const div=document.createElement('div');div.className='goal';let html=`<strong>${day}</strong><br>`;Object.entries(d.logs[day]).forEach(([s,t])=>html+=`${s}: ${Math.floor(t/60)}åˆ†<br>`);div.innerHTML=html;logList.appendChild(div);if(prev){const diff=(new Date(prev)-new Date(day))/(1000*60*60*24);if(diff===1)streakCount++}prev=day});streak.textContent=`ğŸ”¥ é€£ç¶š ${streakCount+1} æ—¥`}

function showGraph(){main.classList.add('hidden');graph.classList.remove('hidden');drawGraph()}
function backMainFromGraph(){graph.classList.add('hidden');main.classList.remove('hidden')}

function drawGraph(){const ctx=chart.getContext('2d');ctx.clearRect(0,0,320,220);const d=getData();const days=Object.keys(d.logs).slice(-7);const vals=days.map(day=>{let t=0;Object.values(d.logs[day]).forEach(v=>t+=v);return Math.floor(t/60)});const max=Math.max(...vals,1);vals.forEach((v,i)=>{const h=(v/max)*160;ctx.fillStyle='#6366f1';ctx.fillRect(30+i*40,190-h,24,h);ctx.fillStyle='#000';ctx.fillText(v+'m',30+i*40,180-h)})}

init();
</script>

</body>
</html>
