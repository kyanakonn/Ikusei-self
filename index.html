<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Self Growth App</title>

<style>
body{margin:0;font-family:system-ui;background:#f4f6fb}
.screen{display:none;max-width:480px;margin:auto;padding:16px}
.active{display:block}
h1{text-align:center}
button,input,select{width:100%;padding:12px;margin-top:10px;font-size:16px}
.card{background:#fff;padding:12px;border-radius:12px;margin-top:12px}
.bar{height:14px;background:#ddd;border-radius:8px;overflow:hidden}
.bar-inner{height:100%;background:#4caf50;width:0%}
#timerOverlay{
  position:fixed;inset:0;background:#000;color:#0f0;
  display:none;flex-direction:column;
  justify-content:center;align-items:center;
  z-index:9999
}
#timerOverlay.active{display:flex}
#timerText{font-size:64px}
canvas{background:#fff;border-radius:12px}
.small{font-size:13px;color:#555}
</style>
</head>
<body>

<!-- HOME -->
<div id="home" class="screen active">
<h1>è‚²æˆãƒ›ãƒ¼ãƒ </h1>

<div class="card">
Lv <span id="lv"></span>
<div class="bar"><div class="bar-inner" id="expBar"></div></div>
<div class="small">æ¬¡ã¾ã§ <span id="nextExp"></span> EXP</div>
</div>

<button onclick="startTimer()">â–¶ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹</button>
<button onclick="show('manual')">âœ æ‰‹å‹•è¨˜éŒ²</button>
<button onclick="show('graph')">ğŸ“ˆ ã‚°ãƒ©ãƒ•</button>
</div>

<!-- TIMER -->
<div id="timerOverlay">
<div id="timerText">0:00</div>
<button onclick="stopTimer()">STOP</button>
</div>

<!-- MANUAL -->
<div id="manual" class="screen">
<h1>æ‰‹å‹•è¨˜éŒ²</h1>
<input id="goalInput" placeholder="ç›®æ¨™ï¼ˆä¾‹ï¼šè‹±èªï¼‰">
<input id="h" type="number" placeholder="æ™‚é–“">
<input id="m" type="number" placeholder="åˆ†">
<button onclick="saveManual()">ä¿å­˜</button>
<button onclick="show('home')">æˆ»ã‚‹</button>
</div>

<!-- GRAPH -->
<div id="graph" class="screen">
<h1>7æ—¥ã‚°ãƒ©ãƒ•</h1>
<canvas id="chart" width="360" height="240"></canvas>
<button onclick="show('home')">æˆ»ã‚‹</button>
</div>

<script>
/* ===== DATA ===== */
const data = JSON.parse(localStorage.getItem('sg')) || {
  level:1,exp:0,logs:{}
};
const colors = {};
const colorList=['#ef4444','#3b82f6','#22c55e','#eab308','#a855f7','#14b8a6'];
function save(){localStorage.setItem('sg',JSON.stringify(data))}
function today(){return new Date().toISOString().slice(0,10)}

/* ===== SCREEN ===== */
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  if(id==='home') render();
  if(id==='graph') drawGraph();
  document.getElementById(id).classList.add('active');
}

/* ===== LEVEL ===== */
function needExp(){return 100*data.level*data.level}
function addExp(min){
  data.exp+=min;
  while(data.exp>=needExp()){
    data.exp-=needExp();
    data.level++;
  }
}

/* ===== TIMER ===== */
let sec=0,timer=null,running=false;
function startTimer(){
  if(running)return;
  running=true;sec=0;
  timerOverlay.classList.add('active');
  timer=setInterval(()=>{
    sec++;
    timerText.textContent=
      Math.floor(sec/60)+':'+String(sec%60).padStart(2,'0');
  },1000);
}
function stopTimer(){
  if(!running)return;
  clearInterval(timer);
  running=false;
  timerOverlay.classList.remove('active');
  saveLog('ã‚¿ã‚¤ãƒãƒ¼',Math.floor(sec/60));
  show('home');
}

/* ===== MANUAL ===== */
function saveManual(){
  const g=goalInput.value.trim();
  const min=(Number(h.value)||0)*60+(Number(m.value)||0);
  if(!g||min<=0)return alert('å…¥åŠ›ä¸è¶³');
  saveLog(g,min);
  goalInput.value=h.value=m.value='';
  show('home');
}

/* ===== LOG ===== */
function saveLog(goal,min){
  const d=today();
  data.logs[d]=data.logs[d]||{};
  data.logs[d][goal]=(data.logs[d][goal]||0)+min;
  addExp(min);
  save();
}

/* ===== UI ===== */
function render(){
  lv.textContent=data.level;
  nextExp.textContent=needExp()-data.exp;
  expBar.style.width=(data.exp/needExp()*100)+'%';
}

/* ===== GRAPH ===== */
function drawGraph(){
  const ctx=chart.getContext('2d');
  ctx.clearRect(0,0,360,240);

  const days=[...Array(7)].map((_,i)=>{
    const d=new Date();d.setDate(d.getDate()-6+i);
    return d.toISOString().slice(0,10);
  });

  // collect goals
  const goals=new Set();
  days.forEach(d=>{
    if(data.logs[d]) Object.keys(data.logs[d]).forEach(g=>goals.add(g));
  });

  [...goals].forEach((g,i)=>{
    if(!colors[g]) colors[g]=colorList[i%colorList.length];
  });

  const max=60;
  days.forEach((day,i)=>{
    let y=200;
    if(data.logs[day]){
      for(const [g,v] of Object.entries(data.logs[day])){
        const h=v/max*160;
        ctx.fillStyle=colors[g];
        ctx.fillRect(30+i*45,y-h,30,h);
        y-=h;
      }
    }
    ctx.fillStyle='#000';
    ctx.fillText(day.slice(5),28+i*45,220);
  });
}

render();
</script>
</body>
</html>
