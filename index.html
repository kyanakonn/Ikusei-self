<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Self Growth App</title>

<style>
body{
 margin:0;
 font-family:system-ui;
 background:#020617;
 color:#fff;
 text-align:center;
}

.screen{
 display:none;
 min-height:100vh;
 padding:20px;
 box-sizing:border-box;
}

.screen.active{display:block}

button,input{
 width:100%;
 padding:16px;
 margin-top:12px;
 border-radius:18px;
 border:none;
 font-size:1rem;
}

button{background:#38bdf8;color:#000;font-weight:bold}
button.sub{background:#475569;color:#fff}

.timer{
 font-size:4.5rem;
 margin:40px 0;
 font-weight:bold;
}

.panel{
 background:#020617;
 border-radius:20px;
 padding:16px;
 margin-top:16px;
 border:1px solid #1e293b;
}

.bar{
 height:16px;
 background:#334155;
 border-radius:8px;
 overflow:hidden;
}
.bar div{
 height:100%;
 background:#22c55e;
 width:0%;
}
.small{opacity:.8;margin-top:6px}
</style>
</head>

<body>

<!-- ================= HOME ================= -->
<div id="home" class="screen active">
<h1>Self Growth</h1>

<div class="panel">
Lv <span id="lv">1</span>
<div class="bar"><div id="expBar"></div></div>
<div class="small">æ¬¡ã¾ã§ <span id="needExp"></span> EXP</div>
</div>

<div class="panel">
<h3>ä»Šé€±ã®ç›®æ¨™</h3>
<input id="wh" type="number" placeholder="æ™‚é–“">
<input id="wm" type="number" placeholder="åˆ†">
<button onclick="setWeek()">è¨­å®š</button>
<div class="bar"><div id="weekBar"></div></div>
<div class="small" id="weekText"></div>
</div>

<button onclick="startTimer()">â–¶ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹</button>
</div>

<!-- ================= TIMER ================= -->
<div id="timer" class="screen">
<h2>é›†ä¸­ä¸­</h2>
<div class="timer" id="timeText">0:00</div>
<button onclick="stopTimer()">STOP</button>
</div>

<!-- ================= SAVE ================= -->
<div id="save" class="screen">
<h2>è¨˜éŒ²ã—ã¾ã™ã‹ï¼Ÿ</h2>
<div class="timer" id="saveTime">0:00</div>
<button onclick="saveRecord()">ä¿å­˜ã™ã‚‹</button>
<button class="sub" onclick="goHome()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
</div>

<script>
/* ========= DATA ========= */
let data = JSON.parse(localStorage.getItem('sg2')) || {
 lv:1, exp:0, logs:{},
 weekGoal:0, weekStart:''
};

const saveData=()=>localStorage.setItem('sg2',JSON.stringify(data));

/* ========= UTILS ========= */
const today=()=>new Date().toISOString().slice(0,10);
function weekStart(){
 const d=new Date();
 const day=d.getDay()||7;
 d.setDate(d.getDate()-day+1);
 return d.toISOString().slice(0,10);
}

/* ========= SCREEN ========= */
function show(id){
 document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}

/* ========= EXP ========= */
function gainExp(min){
 data.exp+=Math.floor(min*1.2);
 while(data.exp>=100*data.lv*data.lv){
  data.exp-=100*data.lv*data.lv;
  data.lv++;
 }
}

/* ========= RENDER ========= */
function render(){
 lv.textContent=data.lv;
 const need=100*data.lv*data.lv;
 expBar.style.width=Math.min(data.exp/need*100,100)+'%';
 needExp.textContent=need-data.exp;

 let used=0;
 Object.entries(data.logs).forEach(([d,g])=>{
  if(d>=data.weekStart)
   Object.values(g).forEach(v=>used+=v);
 });
 weekBar.style.width=data.weekGoal?Math.min(used/data.weekGoal*100,100)+'%':'0%';
 const rem=data.weekGoal-used;
 weekText.textContent=data.weekGoal
  ? rem>0?`æ®‹ã‚Š ${Math.floor(rem/60)}æ™‚é–“${rem%60}åˆ†`:'ğŸ‰é”æˆ'
  :'æœªè¨­å®š';

 saveData();
}
if(data.weekStart!==weekStart()) data.weekStart=weekStart();
render();

/* ========= TIMER ========= */
let startTime=0, elapsed=0, timerId=null;

function startTimer(){
 startTime=Date.now();
 elapsed=0;
 timeText.textContent='0:00';
 show('timer');
 timerId=setInterval(()=>{
  elapsed=Math.floor((Date.now()-startTime)/1000);
  timeText.textContent=format(elapsed);
 },500);
}

function stopTimer(){
 clearInterval(timerId);
 saveTime.textContent=format(elapsed);
 show('save');
}

function saveRecord(){
 const min=Math.floor(elapsed/60);
 if(min>0){
  const d=today();
  data.logs[d]=data.logs[d]||{};
  data.logs[d]['ã‚¿ã‚¤ãƒãƒ¼']=(data.logs[d]['ã‚¿ã‚¤ãƒãƒ¼']||0)+min;
  gainExp(min);
 }
 elapsed=0;
 render();
 goHome();
}

function goHome(){
 clearInterval(timerId);
 show('home');
}

/* ========= WEEK ========= */
function setWeek(){
 data.weekGoal=Number(wh.value)*60+Number(wm.value);
 render();
}

function format(s){
 return Math.floor(s/60)+':'+String(s%60).padStart(2,'0');
}
</script>
</body>
</html>
