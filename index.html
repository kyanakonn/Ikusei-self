<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Self Growth App</title>
<style>
body{margin:0;font-family:system-ui;background:#0f172a;color:#fff}
.card{max-width:480px;margin:auto;padding:16px}
.hidden{display:none}
button,input,select{width:100%;padding:12px;margin-top:8px;border-radius:12px;border:none;font-size:15px}
button{background:#6366f1;color:#fff;font-weight:bold}
.sub{background:#334155}
h1{font-size:1.4rem}
.box{background:#020617;padding:12px;border-radius:14px;margin-top:10px}
.bar{height:14px;background:#1e293b;border-radius:10px;overflow:hidden}
.bar>div{height:100%;background:linear-gradient(90deg,#22d3ee,#6366f1)}
.bigTimer{position:fixed;inset:0;background:#020617;display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:48px;z-index:9}
.goal{background:#1e293b;padding:8px;border-radius:10px;margin-top:6px}
</style>
</head>
<body>

<div class="card">

<!-- ENTRY -->
<div id="entry">
<h1>Self Growth</h1>
<button onclick="newUser()">新しく始める</button>
<button onclick="login()">引き継ぎコード</button>
</div>

<!-- SETUP -->
<div id="setup" class="hidden">
<h1>初期設定</h1>
<input id="nickname" placeholder="ニックネーム">
<button onclick="saveUser()">開始</button>
</div>

<!-- LOGIN -->
<div id="login" class="hidden">
<h1>ログイン</h1>
<input id="codeInput" placeholder="引き継ぎコード">
<button onclick="doLogin()">ログイン</button>
</div>

<!-- GOAL -->
<div id="goalScreen" class="hidden">
<h1>目標</h1>
<input id="goalText" placeholder="例：英語長文">
<button onclick="addGoal()">追加</button>
<div id="goalList"></div>
<button onclick="goMain()">メインへ</button>
</div>

<!-- MAIN -->
<div id="main" class="hidden">
<h1 id="welcome"></h1>
<div class="box">
Lv.<span id="level">1</span>　
EXP <span id="exp">0</span> / <span id="nextExp">100</span>
<div class="bar"><div id="expBar"></div></div>
</div>

<div class="box">
週目標残り：<span id="remainWeek">0</span> 分
</div>

<select id="goalSelect"></select>

<button onclick="startTimer()">START</button>
<button class="sub" onclick="stopTimer()">STOP</button>
<button class="sub" onclick="saveManual()">手動記録</button>

<button class="sub" onclick="showProfile()">プロフィール</button>
<button class="sub" onclick="showLogs()">記録</button>
</div>

<!-- PROFILE -->
<div id="profile" class="hidden">
<h1>プロフィール</h1>
<div class="box">Lv <span id="pLevel"></span></div>
<div class="box">最高連続 <span id="pStreak"></span> 日</div>
<div class="box">達成数 <span id="pClear"></span></div>
<button onclick="backMain()">戻る</button>
</div>

<!-- LOG -->
<div id="logs" class="hidden">
<h1>日別ログ</h1>
<div id="logList"></div>
<button onclick="backMain()">戻る</button>
</div>

</div>

<!-- TIMER FULL -->
<div id="timerView" class="bigTimer hidden">
<div id="timerText">0:00</div>
<button onclick="stopTimer()">STOP</button>
</div>

<script>
/* ===== DATA ===== */
let timer=null,startAt=0;

function all(){return JSON.parse(localStorage.getItem("sg_all")||"{}")}
function saveAll(a){localStorage.setItem("sg_all",JSON.stringify(a))}
function cur(){return localStorage.getItem("sg_cur")}

function newUser(){entry.classList.add("hidden");setup.classList.remove("hidden")}
function login(){entry.classList.add("hidden");loginDiv.classList.remove("hidden")}

function saveUser(){
 const name=nickname.value.trim(); if(!name)return;
 let code=Math.random().toString(36).slice(2,8).toUpperCase()
 let a=all()
 a[code]={name,goals:[],logs:{},exp:0,level:1,weekGoal:600,streak:0,best:0,clear:0}
 saveAll(a); localStorage.setItem("sg_cur",code); init()
}

function doLogin(){
 let c=codeInput.value.trim().toUpperCase()
 if(!all()[c])return alert("違います")
 localStorage.setItem("sg_cur",c); init()
}

function data(){return all()[cur()]}
function save(d){let a=all();a[cur()]=d;saveAll(a)}

function init(){
 entry.classList.add("hidden");setup.classList.add("hidden");login.classList.add("hidden")
 goalScreen.classList.remove("hidden"); renderGoals()
}

function addGoal(){
 let d=data(); let t=goalText.value.trim(); if(!t)return
 d.goals.push(t); save(d); renderGoals(); goalText.value=""
}

function renderGoals(){
 let d=data(); goalList.innerHTML=""
 d.goals.forEach(g=>{
  let div=document.createElement("div")
  div.className="goal"; div.textContent=g
  goalList.appendChild(div)
 })
}

function goMain(){
 goalScreen.classList.add("hidden");main.classList.remove("hidden")
 let d=data()
 welcome.textContent=`ようこそ ${d.name}`
 level.textContent=d.level; exp.textContent=d.exp
 nextExp.textContent=d.level*d.level*100
 expBar.style.width=Math.min(100,(d.exp/(d.level*d.level*100))*100)+"%"
 goalSelect.innerHTML=""
 d.goals.forEach(g=>{
  let o=document.createElement("option");o.textContent=g;goalSelect.appendChild(o)
 })
 updateWeek()
}

function updateWeek(){
 let d=data()
 let used=0
 Object.values(d.logs).forEach(v=>used+=v)
 remainWeek.textContent=Math.max(0,d.weekGoal-used)
}

/* TIMER */
function startTimer(){
 if(timer)return
 startAt=Date.now()
 timerView.classList.remove("hidden")
 timer=setInterval(()=>{
  let s=Math.floor((Date.now()-startAt)/1000)
  timerText.textContent=Math.floor(s/60)+":"+String(s%60).padStart(2,"0")
 },1000)
}

function stopTimer(){
 if(!timer)return
 clearInterval(timer); timer=null
 timerView.classList.add("hidden")
 let min=Math.floor((Date.now()-startAt)/60000)
 saveLog(min)
}

function saveManual(){
 let min=prompt("何分やりましたか？")
 if(!min)return
 saveLog(parseInt(min))
}

function saveLog(min){
 let d=data(); let day=new Date().toISOString().slice(0,10)
 d.logs[day]=(d.logs[day]||0)+min
 let bonus=1+d.streak/10
 d.exp+=Math.floor(min*bonus)
 if(d.exp>=d.level*d.level*100){d.exp=0;d.level++}
 save(d); goMain()
}

/* PROFILE */
function showProfile(){
 main.classList.add("hidden");profile.classList.remove("hidden")
 let d=data()
 pLevel.textContent=d.level
 pStreak.textContent=d.best
 pClear.textContent=d.clear
}

function showLogs(){
 main.classList.add("hidden");logs.classList.remove("hidden")
 let d=data(); logList.innerHTML=""
 Object.entries(d.logs).reverse().forEach(([k,v])=>{
  let div=document.createElement("div")
  div.className="box"; div.textContent=`${k} : ${v}分`
  logList.appendChild(div)
 })
}

function backMain(){
 profile.classList.add("hidden");logs.classList.add("hidden")
 main.classList.remove("hidden")
}

</script>
</body>
</html>
