<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Self Growth App</title>
<style>
body{margin:0;font-family:system-ui;background:#020617;color:#fff}
.card{max-width:480px;margin:auto;padding:16px}
h1{text-align:center}
button,input{width:100%;padding:14px;margin-top:10px;border-radius:16px;border:none}
button{background:#38bdf8;color:#000;font-weight:bold}
button.sub{background:#475569;color:#fff}
button:disabled{opacity:.4}
.panel{background:#020617;border-radius:20px;padding:14px;margin-top:14px}
.hidden{display:none}

/* ===== TIMER ===== */
.fullscreen{
 position:fixed;inset:0;
 background:#020617;
 display:flex;flex-direction:column;
 justify-content:center;align-items:center;
 z-index:9999
}
.timer{
 font-size:4rem;font-weight:bold;
 margin-bottom:20px
}
.small{opacity:.8}

/* ===== BAR ===== */
.bar{height:16px;background:#334155;border-radius:8px;overflow:hidden}
.bar>div{height:100%;background:#22c55e}

/* ===== GRAPH ===== */
canvas{background:#020617;border-radius:16px;margin-top:10px}
.legend{font-size:.85rem;margin-top:8px}
.legend span{margin-right:10px}
.legend i{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:4px}
</style>
</head>
<body>

<div class="card" id="main">
<h1>Self Growth</h1>

<div class="panel">
Lv <span id="lv">1</span>
<div class="bar"><div id="expBar"></div></div>
<div class="small">æ¬¡ã¾ã§ <span id="needExp"></span> EXP</div>
</div>

<div class="panel">
<h3>ä»Šé€±ã®ç›®æ¨™</h3>
<input id="wh" type="number" placeholder="æ™‚é–“">
<input id="wm" type="number" placeholder="åˆ†">
<button onclick="setWeek()">è¨­å®š</button>
<div class="bar"><div id="weekBar"></div></div>
<div class="small" id="weekText"></div>
</div>

<div class="panel">
<button onclick="startTimer()">â–¶ START</button>
</div>

<button class="sub" onclick="openGraph()">ğŸ“Š ã‚°ãƒ©ãƒ•</button>
<button class="sub" onclick="openProfile()">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
</div>

<!-- ===== FULLSCREEN TIMER ===== -->
<div id="fs" class="fullscreen hidden">
<div class="timer" id="fsTime">0:00</div>
<button onclick="stopTimer()">STOP</button>
<button class="sub hidden" id="saveBtn" onclick="saveTimer()">SAVE</button>
</div>

<!-- ===== GRAPH ===== -->
<div id="graph" class="hidden card">
<h1>7æ—¥ã‚°ãƒ©ãƒ•</h1>
<canvas id="chart" width="360" height="240"></canvas>
<div id="legend" class="legend"></div>
<button onclick="closeGraph()">æˆ»ã‚‹</button>
</div>

<!-- ===== PROFILE ===== -->
<div id="profile" class="hidden card">
<h1>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h1>
<div class="panel">
<div>Lv: <span id="pLv"></span></div>
<div>ç´¯è¨ˆæ™‚é–“: <span id="pTime"></span></div>
<div>æœ€é«˜é€£ç¶šæ—¥æ•°: <span id="pStreak"></span></div>
</div>
<button onclick="closeProfile()">æˆ»ã‚‹</button>
</div>

<script>
/* ===== DATA ===== */
let data=JSON.parse(localStorage.getItem('sg'))||{
 lv:1,exp:0,logs:{},streak:0,maxStreak:0,
 weekGoal:0,weekStart:''
}
const save=()=>localStorage.setItem('sg',JSON.stringify(data))
const today=()=>new Date().toISOString().slice(0,10)

/* ===== EXP ===== */
function gainExp(min){
 let gain=Math.floor(min*(1+data.streak/10))
 data.exp+=gain
 while(data.exp>=100*data.lv*data.lv){
  data.exp-=100*data.lv*data.lv
  data.lv++
 }
}

/* ===== WEEK ===== */
function weekStart(){
 const d=new Date();const day=d.getDay()||7
 d.setDate(d.getDate()-day+1)
 return d.toISOString().slice(0,10)
}
if(data.weekStart!==weekStart()){
 data.weekStart=weekStart()
}
save()

/* ===== UI ===== */
function render(){
 lv.textContent=data.lv
 const need=100*data.lv*data.lv
 expBar.style.width=Math.min(data.exp/need*100,100)+'%'
 needExp.textContent=need-data.exp

 let used=0
 Object.entries(data.logs).forEach(([d,g])=>{
  if(d>=data.weekStart)
   Object.values(g).forEach(v=>used+=v)
 })
 const r=data.weekGoal?used/data.weekGoal:0
 weekBar.style.width=Math.min(r*100,100)+'%'
 const rem=Math.max(0,data.weekGoal-used)
 weekText.textContent=data.weekGoal
  ? rem>0?`æ®‹ã‚Š ${Math.floor(rem/60)}æ™‚é–“${rem%60}åˆ†`:'ğŸ‰é”æˆ'
  :'æœªè¨­å®š'
 save()
}
render()

/* ===== TIMER (REAL TIME) ===== */
let startAt=0,elapsed=0,iv=null,running=false

function fmt(s){
 return Math.floor(s/60)+':'+String(s%60).padStart(2,'0')
}

function startTimer(){
 if(running)return
 running=true
 elapsed=0
 startAt=Date.now()
 fs.classList.remove('hidden')
 saveBtn.classList.add('hidden')
 iv=setInterval(()=>{
  elapsed=Math.floor((Date.now()-startAt)/1000)
  fsTime.textContent=fmt(elapsed)
 },500)
}

function stopTimer(){
 if(!running)return
 clearInterval(iv)
 running=false
 saveBtn.classList.remove('hidden')
}

function saveTimer(){
 const min=Math.floor(elapsed/60)
 if(min>0){
  const d=today()
  data.logs[d]=data.logs[d]||{}
  data.logs[d]['ã‚¿ã‚¤ãƒãƒ¼']=(data.logs[d]['ã‚¿ã‚¤ãƒãƒ¼']||0)+min

  const y=new Date();y.setDate(y.getDate()-1)
  data.streak=data.logs[y.toISOString().slice(0,10)]?data.streak+1:1
  data.maxStreak=Math.max(data.maxStreak,data.streak)

  gainExp(min)
 }
 fs.classList.add('hidden')
 elapsed=0
 fsTime.textContent='0:00'
 render()
}

/* ===== GRAPH ===== */
const colors=['#38bdf8','#22c55e','#facc15','#f472b6','#a78bfa']
const colorMap={}
const getColor=k=>colorMap[k]||(colorMap[k]=colors[Object.keys(colorMap).length%colors.length])

function openGraph(){
 main.classList.add('hidden')
 graph.classList.remove('hidden')
 drawGraph()
}
function closeGraph(){
 graph.classList.add('hidden')
 main.classList.remove('hidden')
}

function drawGraph(){
 const ctx=chart.getContext('2d')
 ctx.clearRect(0,0,360,240)
 legend.innerHTML=''
 const days=[]
 for(let i=6;i>=0;i--){
  const d=new Date();d.setDate(d.getDate()-i)
  days.push(d.toISOString().slice(0,10))
 }
 const goals=new Set()
 days.forEach(d=>{
  if(data.logs[d])
   Object.keys(data.logs[d]).forEach(g=>goals.add(g))
 })
 goals.forEach(g=>{
  legend.innerHTML+=`<span><i style="background:${getColor(g)}"></i>${g}</span>`
 })
 days.forEach((d,i)=>{
  let y=220
  if(data.logs[d]){
   Object.entries(data.logs[d]).forEach(([g,v])=>{
    const h=v/5
    ctx.fillStyle=getColor(g)
    ctx.fillRect(30+i*45,y-h,30,h)
    y-=h
   })
  }
  ctx.fillStyle='#94a3b8'
  ctx.fillText(d.slice(5),30+i*45,235)
 })
}

/* ===== PROFILE ===== */
function openProfile(){
 main.classList.add('hidden')
 profile.classList.remove('hidden')
 let total=0
 Object.values(data.logs).forEach(g=>{
  Object.values(g).forEach(v=>total+=v)
 })
 pLv.textContent=data.lv
 pTime.textContent=`${Math.floor(total/60)}æ™‚é–“${total%60}åˆ†`
 pStreak.textContent=data.maxStreak
}
function closeProfile(){
 profile.classList.add('hidden')
 main.classList.remove('hidden')
}

/* ===== WEEK SET ===== */
function setWeek(){
 data.weekGoal=Number(wh.value)*60+Number(wm.value)
 render()
}
</script>
</body>
</html>
